@model ApostasApp.Core.Presentation.ViewModels.RegisterViewModel

<div class="container mt-5">

    <h2>Registrar Usuário</h2>

    <form asp-action="Register" method="post">

        <div asp-validation-summary="All"></div>

        <div class="card mb-3">
            <div class="card-header">Dados de Identificação</div>
            <div class="card-body">

                <div class="form-group">
                    <label asp-for="Email"></label>
                    <input asp-for="Email" class="form-control" />
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="CPF"></label>
                    <p class="text-muted">O CPF só aceita NÚMEROS no formato 999.999.999-99.</p>
                    <input asp-for="CPF" class="form-control col-md-3" type="tel" />
                    <span asp-validation-for="CPF" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Apelido"></label>
                    <input asp-for="Apelido" class="form-control" />
                    <span asp-validation-for="Apelido" class="text-danger"></span>
                </div>

            </div>

        </div>

        <div class="card mb-3">
            <div class="card-header">Dados de Contato</div>
            <div class="card-body">
                <div class="form-group">
                    <label asp-for="Celular"></label>
                    <p class="text-muted">O CELULAR só aceita NÚMEROS no formato (99) 99999-9999.</p>
                    <input asp-for="Celular" class="form-control col-md-4" aria-label="Celular" type="tel" />
                    <span asp-validation-for="Celular" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">Dados de Acesso</div>
            <div class="card-body">

                <div class="form-group">
                    <label asp-for="Password"></label>
                    <p class="text-muted">A senha deve ter pelo menos 8 caracteres, uma letra maiúscula, um símbolo e um número.</p>
                    <div class="input-group">
                        <input asp-for="Password" class="form-control" type="password" id="passwordInput" />
                        <div class="input-group-append">
                            <span class="input-group-text">
                                <i class="fas fa-eye" id="togglePassword"></i>
                            </span>
                        </div>
                    </div>
                    <span asp-validation-for="Password" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="ConfirmPassword"></label>
                    <input asp-for="ConfirmPassword" class="form-control" />
                    <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary" >Registrar</button>
    </form>
</div>

@section Scripts {

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>    
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
     
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function () {
            $("#togglePassword").click(function () {
                var passwordInput = $("#passwordInput");
                var type = passwordInput.attr("type") === "password" ? "text" : "password";
                passwordInput.attr("type", type);
                $(this).toggleClass("fa-eye fa-eye-slash");
            });
        });


        function validarCPF(cpf) {

            console.log('CPF recebido:', cpf);
            cpf = cpf.replace(/[^\d]+/g, '');
            console.log('CPF sem caracteres:', cpf);
            if (cpf == '') return false;
            if (cpf.length != 11) return false;
            cpf = cpf.replace(/[^\d]+/g, '');
            if (cpf == '') return false;
            if (cpf.length != 11) return false;

            if (cpf == '00000000000' ||
                cpf == '11111111111' ||
                cpf == '22222222222' ||
                cpf == '33333333333' ||
                cpf == '44444444444' ||
                cpf == '55555555555' ||
                cpf == '66666666666' ||
                cpf == '77777777777' ||
                cpf == '88888888888' ||
                cpf == '99999999999')
                return false;
            add = 0;
            for (i = 0; i < 9; i++)
                add += parseInt(cpf.charAt(i)) * (10 - i);
            rev = 11 - (add % 11);
            if (rev == 10 || rev == 11)
                rev = 0;
            if (rev != parseInt(cpf.charAt(9)))
                return false;
            add = 0;
            for (i = 0; i < 10; i++)
                add += parseInt(cpf.charAt(i)) * (11 - i);
            rev = 11 - (add % 11);
            if (rev == 10 || rev == 11)
                rev = 0;
            if (rev != parseInt(cpf.charAt(10)))
                return false;
            return true;
        }

        $(document).ready(function () {
            $('#CPF').mask('000.000.000-00');
            $('#Celular').mask('(00) 00000-0000');

            $('form').submit(function () {
            var cpf = $('#CPF').val();
            cpf = cpf.replace(/\D/g, ''); // Remove caracteres não numéricos
            $('#CPF').val(cpf); // Atualiza o valor do campo com o CPF sem máscara
        });

            $('#CPF').on('blur', function () {
                var cpf = $(this).val();
                if (!validarCPF(cpf)) {
                    $(this).next('.text-danger').text('CPF inválido. Verifique os dígitos verificadores.');
                } else {
                    $(this).next('.text-danger').text('');
                }
            });
        });
               

        $('#Apelido').on('blur', function () {
            var apelido = $(this).val();
            $.ajax({
                url: '/Account/VerificarApelido',
                type: 'POST',
                data: { apelido: apelido },
                success: function (resultado) {
                    if (resultado.disponivel) {
                        $('#Apelido').next('.text-danger').text('');
                    } else {
                        $('#Apelido').next('.text-danger').text('Apelido já está em uso.');
                    }
                }
            });
        });


    </script>
    
}


